<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comparador de Packs de Fertilidad</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { margin: 0; font-family: Arial, sans-serif; background: #f4f7fb; color: #333; }
.sidebar { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: linear-gradient(180deg, #d5006d, #ff4081); color: #fff; display: flex; align-items: center; gap: 12px; padding: 0 16px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.15); }
.sidebar-title { font-size: 1.3rem; font-weight: bold; color: #fff; margin: 0; margin-right: auto; }
.content { margin-top: 90px; padding: 30px; }
.main-title { padding: 20px; font-size: 1.5rem; font-weight: bold; color: #d5006d; background: #fff; border-radius: 8px; margin-bottom: 20px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.section { background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

.intro-text { font-size: 1rem; color: #555; margin: 10px auto 20px auto; max-width: 800px; text-align: center; line-height: 1.5; }

.button-container { margin-top: 1rem; text-align: center; }
.button-container button { width: 100%; max-width: 400px; padding: 12px 20px; font-size: 1.1rem; font-weight: bold; background-color: #d5006d; color: white; border: none; border-radius: 10px; cursor: pointer; }
.button-container button:hover { background: #a30050; }

table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background-color: #f8bbd0; }
#profitChart { max-width: 100%; height: 400px !important; }

/* Packs */
.packs-container { display: flex; flex-direction: column; align-items: center; gap: 2rem; padding: 0.5rem; }
.card { width: 100%; max-width: 700px; background: #f8bbd0; padding: 1rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.product-row { display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.5rem; }
.product-row .product-name { min-width: 90px; font-weight: bold; }
.product-row input { flex: 1; padding: 6px 8px; border-radius: 6px; border: 1px solid #ccc; }
.inputs-table { width: 100%; border-collapse: collapse; }
.inputs-table th, .inputs-table td { padding: 6px; text-align: center; }
.inputs-table input { width: 80px; padding: 6px; border-radius: 6px; border: 1px solid #ccc; }

.packs-container-horizontal { display: flex; flex-wrap: nowrap; gap: 1rem; overflow-x: auto; padding: 1rem 0; }
.packs-container-horizontal::-webkit-scrollbar { height: 8px; }
.packs-container-horizontal::-webkit-scrollbar-thumb { background: #d5006d; border-radius: 4px; }

.pack1 { background-color: #f8d1dc; }
.pack2 { background-color: #d9f0e1; }
.pack1 input { background-color: #ffe6f0; }
.pack2 input { background-color: #e6f9f1; }
.pack1 th { background-color: #f8b0c8; color: #333; }
.pack2 th { background-color: #c8efd8; color: #333; }
.pack1 h3 { color: #d5006d; }
.pack2 h3 { color: #009688; }

.kpi-grid { display: flex; gap: 12px; margin: 20px 0; align-items: stretch; }
.kpi-card { flex: 1; background: #ffffff; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid rgba(0,0,0,0.04); }
.kpi-card h4 { margin: 0 0 8px 0; color: #d5006d; font-size: 0.95rem; }
.kpi-value { font-size: 1.25rem; font-weight: 700; color: #222; }
.kpi-card.best { box-shadow: 0 6px 18px rgba(0, 128, 0, 0.12); border: 2px solid #2e8b57; }

.fertility-intro { background-color: #fdf5f8; border-left: 4px solid #d5006d; padding: 1.5rem; margin-bottom: 2rem; border-radius: 8px; }
.fertility-intro h2 { color: #d5006d; font-size: 1.6rem; margin-bottom: 0.8rem; }
.fertility-intro p { color: #444; line-height: 1.6; margin-bottom: 1rem; }
.fertility-intro a { color: #d5006d; text-decoration: underline; }

.highlight-section {
    background-color: #fff0f5;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.highlight-section h2 {
    color: #d5006d;
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 1.5rem;
}

.benefit-container {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.benefit-card {
    flex: 1 1 300px; /* ancho m√≠nimo y flexible */
    background-color: #ffe6f0;
    border-radius: 12px;
    padding: 1.2rem;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.benefit-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.benefit-card i {
    font-size: 2rem;
    color: #d5006d;
    margin-bottom: 0.5rem;
}

.benefit-card h3 {
    font-size: 1.2rem;
    color: #d5006d;
    margin: 0.5rem 0;
}

.benefit-card p {
    font-size: 0.95rem;
    color: #555;
    line-height: 1.5;
}

.results-table-container {
    width: 100%;
    overflow-x: auto;
}

table th, table td {
    padding: 6px;
    text-align: center;
    min-width: 120px; /* columnas no se comprimen demasiado */
}

/* Contenedor de la tabla */
.results-table-container {
    width: 100%;
    overflow-x: auto;
    margin-top: 1rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    background: #fff;
    padding: 12px;
}

/* Tabla */
.results-table-container table {
    width: 100%;
    border-collapse: separate; /* permite bordes redondeados */
    border-spacing: 0;
    font-family: Arial, sans-serif;
}

/* Cabecera */
.results-table-container th {
    background: linear-gradient(90deg, #d5006d, #ff4081);
    color: #fff;
    font-weight: bold;
    text-align: center;
    padding: 10px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

/* Celdas */
.results-table-container td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #f0f0f0;
    font-size: 0.95rem;
}

/* Renglones de optimizaci√≥n (rayo ‚ö°) */
.results-table-container tr.optimized {
    background: #e0f7fa;
    font-weight: bold;
    color: #222;
}

/* Alternar colores de fila para mejor lectura */
.results-table-container tr:nth-child(even) {
    background: #fdf5f8;
}

/* Hover para filas */
.results-table-container tr:hover {
    background: #ffe6f0;
}

/* Columnas clave (Ingresos / Utilidad) destacadas */
.results-table-container td:nth-child(5),
.results-table-container td:nth-child(6) {
    font-weight: 700;
    color: #d5006d;
}

.client-selection.highlight {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  background: linear-gradient(90deg, #d5006d, #f48fb1);
  color: white;
  border-radius: 16px;
  padding: 14px 20px;
  max-width: 420px;
  margin: 25px auto;
  box-shadow: 0 4px 10px rgba(213, 0, 109, 0.3);
}

.client-selection.highlight label {
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.client-selection.highlight select {
  flex: 1;
  padding: 10px 12px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
  font-weight: 600;
  color: #333;
  background: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.client-selection.highlight select:hover {
  transform: scale(1.03);
}

.client-selection.highlight select:focus {
  outline: 2px solid #fff;
}

/* Contenedor general */
.flex-container {
    display: flex;
    justify-content: center;
    align-items: stretch;
    gap: 2rem;
    flex-wrap: wrap;
    margin-top: 1.5rem;
}

/* Tarjeta general: misma base */
.pack-description,
.pack-form {
    flex: 1 1 45%;
    border-radius: 12px;
    padding: 1.8rem 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

/* üé® Mejora est√©tica para el lado izquierdo */
.pack-description {
    background: #fffafc;
    border: 1px solid #f6b5c4;
    position: relative;
}

/* Crea una banda vertical decorativa a la izquierda */
.pack-description::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 6px;
    height: 100%;
    background: linear-gradient(180deg, #ff7fa4, #ffc4d8);
    border-radius: 12px 0 0 12px;
}

/* Mejora la lectura del texto */
.pack-description h3 {
    color: #c12b5e;
    text-align: left;
    margin-bottom: 1rem;
}

.pack-description p {
    font-size: 15px;
    line-height: 1.5;
    color: #333;
}

/* üéØ Ajuste del formulario */
.pack-form {
    background: #ffe0eb;
    border: 1px solid #f6b5c4;
}

/* Centrar t√≠tulos */
.pack-form h2,
.pack-form h3 {
    text-align: center;
    color: #c12b5e;
}

/* Bot√≥n */
.button-container {
    display: flex;
    justify-content: center;
    margin-top: 1.5rem;
}

.button-container button {
    background: linear-gradient(90deg, #ff6584, #ff8ca3);
    border: none;
    color: white;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.button-container button:hover {
    transform: scale(1.05);
}

/* Responsive */
@media (max-width: 900px) {
    .flex-container {
        flex-direction: column;
        align-items: center;
    }

    .pack-description,
    .pack-form {
        max-width: 90%;
    }

    .pack-description::before {
        display: none;
    }
}

.pack-description {
  background: #fff;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  justify-content: center;
  line-height: 1.6;
  color: #444;
}

.pack-header {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  margin-bottom: 1rem;
}

.pack-header i {
  font-size: 2rem;
  color: #e91e63;
}

.pack-header h3 {
  color: #c2185b;
  font-size: 1.4rem;
  margin: 0;
}

/* Texto principal */
.pack-intro {
  margin-bottom: 1.5rem;
  font-size: 1rem;
}

/* Bloques con subt√≠tulos */
.pack-benefits, .pack-stats, .pack-testimonials, .pack-cta {
  margin-bottom: 1.5rem;
}

.pack-benefits h4, .pack-stats h4, .pack-testimonials h4, .pack-cta h4 {
  color: #ad1457;
  margin-bottom: 0.8rem;
  font-size: 1.1rem;
}

/* Lista de beneficios */
.pack-benefits ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
.pack-benefits li {
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.6rem;
}
.pack-benefits i {
  color: #e91e63;
}

/* Testimonios */
.pack-testimonials blockquote {
  background: #fff4f7;
  border-left: 4px solid #f06292;
  padding: 0.8rem 1rem;
  border-radius: 6px;
  margin: 0 0 1rem;
  font-style: italic;
}
.pack-testimonials span {
  display: block;
  font-size: 0.9rem;
  color: #777;
  text-align: right;
}

/* Llamado a la acci√≥n */
.pack-cta {
  background: linear-gradient(90deg, #ffe6f0 0%, #fff0f5 100%);
  border-radius: 8px;
  text-align: center;
  padding: 1rem;
  color: #c2185b;
  font-weight: 500;
}

/* Responsive */
@media (max-width: 900px) {
  .pack-description {
    padding: 1.5rem;
  }
  .pack-header h3 {
    font-size: 1.2rem;
  }
}

</style>
</head>
<body>

<div class="sidebar" style="display:flex; flex-direction:column; padding:12px; gap:6px;">
    <h2 class="sidebar-title"><i class="fa-solid fa-gift"></i> Packs de Fertilidad ‚Äì Optimiza tu Estrategia</h2>
    <div style="font-size:0.85rem; color:#ffd6e0; max-width:400px; line-height:1.2;">
        Calcula costos y rentabilidad de cada pack.
    </div>
    <a href="#resultsTable" style="align-self:flex-end; background:#fff; color:#d5006d; padding:6px 12px; border-radius:6px; font-weight:bold; text-decoration:none;">
        Ver Resultados
    </a>
</div>

<div class="content">
    <div class="main-title"> ü§ùFacilita la Fertilidad: Pack de Baja Complejidad para Distribuidores Exitosos</div>

<!-- Barra de selecci√≥n de cliente -->
<div class="client-selection highlight">
  <label for="clientSelect">
    <i class="fa-solid fa-user-tie"></i> Tipo de cliente:
  </label>
  <select id="clientSelect" onchange="calculateResults()">
      <option value="A">Cliente A </option>
      <option value="B">Cliente B </option>
      <option value="C">Cliente C </option>
  </select>
</div>

    <p class="intro-text">
        Esta herramienta resalta la  <strong>facilidad de uso, la demanda de mercado y la rentabilidad</strong>, calculando su costo total, descuentos aplicados y unidades vendidas. 
        Identifica r√°pida y visualmente la rentabilidad adecuada.
    </p>

    <!-- KPI cards -->
    <div id="kpi-container" class="kpi-grid">
        <div class="kpi-card">
            <h4>üí∞ Pack m√°s rentable</h4>
            <div id="kpi-rentable" class="kpi-value">‚Äî</div>
        </div>
        <div class="kpi-card">
            <h4>üè∑Ô∏è Pack m√°s econ√≥mico (costo total)</h4>
            <div id="kpi-economico" class="kpi-value">‚Äî</div>
        </div>
        <div class="kpi-card">
            <h4>üìä Margen promedio (%)</h4>
            <div id="kpi-ahorro" class="kpi-value">‚Äî</div>
        </div>
    </div>

   <section class="section fertility-intro">
  <h2><i class="fa-solid fa-baby"></i> Fertilidad en Ecuador üë∂</h2>

  <p>
    En 2024, Ecuador registr√≥ <strong>215.714 nacimientos vivos</strong> üçº, 
    reflejando una disminuci√≥n de 23.963 nacimientos con respecto al a√±o anterior.  
    <a href="https://www.ecuadorencifras.gob.ec/institucional/menos-nacimientos-y-cambios-en-los-patrones-maternos-marcan-la-dinamica-demografica-en-ecuador/?utm_source=chatgpt.com" target="_blank">Fuente: Ecuador en Cifras</a>
  </p>

  <p>
    La <strong>tasa de fecundidad total</strong> se situ√≥ en 1.7 hijos por mujer, 
    por debajo del nivel de reemplazo poblacional de 2.1 üå±, indicando una reducci√≥n en la capacidad de crecimiento natural de la poblaci√≥n.  
    <a href="https://ginecologia.ec/la-natalidad-en-ecuador-cae-a-minimos-historicos-causas-cifras-y-advertencias-para-el-futuro/?utm_source=chatgpt.com" target="_blank">Fuente: Ginecolog√≠a Ecuador</a>
  </p>

  <p>
    Adem√°s, el Ministerio de Salud P√∫blica y el Instituto Nacional de Estad√≠stica y Censos han presentado resultados de la 
    <strong>Encuesta Nacional de Demograf√≠a y Salud Sexual y Reproductiva</strong>, proporcionando datos clave sobre la salud reproductiva en el pa√≠s.  
    <a href="https://www.ecuadorencifras.gob.ec/msp-e-inec-presentan-resultados-de-demografia-y-salud-sexual-y-reproductiva/?utm_source=chatgpt.com" target="_blank">Fuente: MSP & INEC</a>
  </p>

  <p>
    En este contexto, herramientas como esta ayudan a tomar decisiones informadas, 
    considerando costos, efectividad y accesibilidad de cada tratamiento ‚ù§Ô∏è.
  </p>
</section>

<section class="section highlight-section">
  <h2><i class="fa-solid fa-star"></i> üí°Pack Inteligente </h2>
  <div class="benefit-container">

<section class="section flex-container">
  <div class="benefit-card pack-description">
    <div class="pack-header">
      <i class="fa-solid fa-heart-circle-plus"></i>
      <h3>üí°Pack Inteligente: Gonal + Crinone + Ovidrel</h3>
    </div>

    <p class="pack-intro">
      Descubre c√≥mo nuestro <strong>Pack de baja complejidad</strong> simplifica el proceso para tus clientes,
      ofreciendo una <strong>soluci√≥n efectiva y accesible</strong> que <strong>maximiza tu rentabilidad</strong>.
      Ideal para distribuidores que buscan <strong>productos de calidad</strong> con enfoque en la
      <strong>simplicidad y el √©xito</strong>.
    </p>

    <div class="pack-benefits">
      <h4>‚ú® Beneficios Clave</h4>
      <ul>
        <li><i class="fa-solid fa-circle-check"></i> F√°cil de usar: simplifica compra y administraci√≥n.</li>
        <li><i class="fa-solid fa-circle-check"></i> Alta demanda: productos populares en el mercado.</li>
        <li><i class="fa-solid fa-circle-check"></i> Soporte de marketing: materiales para promoci√≥n.</li>
        <li><i class="fa-solid fa-circle-check"></i> Flexibilidad: se adapta a distintos clientes.</li>
      </ul>
    </div>


      <h4>üöÄ ¬°Act√∫a Ahora!</h4>
      <p>Cont√°ctanos para descubrir c√≥mo el <strong>Pack Soluci√≥n</strong> puede transformar tu negocio.</p>
   
</div>

    <!-- Formulario de datos -->
    <div class="packs-container pack-form">
        <h2><i class="fa-solid fa-calculator"></i> Ingresar Datos de Packs</h2>
        <div class="card pack1">
            <h3>Pack A: Gonal 450 + Ovidrel + Crinone</h3>
            <table class="inputs-table">
                <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Descuento (%)</th></tr>
                <tr><td>Gonal 450</td><td><input type="number" id="priceGonal450" value="247.50"></td><td><input type="number" id="qtyGonal450" value="1"></td><td><input type="number" id="discountGonal450" value="0" min="0" max="20"></td></tr>
                <tr><td>Ovidrel</td><td><input type="number" id="priceOvidA" value="56.00"></td><td><input type="number" id="qtyOvidA" value="1"></td><td>‚Äî</td></tr>
                <tr><td>Crinone</td><td><input type="number" id="priceCrinone" value="61.02"></td><td><input type="number" id="qtyCrinone" value="2"></td><td><input type="number" id="discountCrinone" value="0" min="0" max="20"></td></tr>
                <tr><td><strong>Costo Total:</strong></td><td><input type="number" id="costPackA" readonly></td><td><input type="number" id="unitsSoldPackA" placeholder="Unidades Vendidas"></td><td></td></tr>
            </table>
        </div>
        <div class="button-container">
            <button onclick="calculateResults()">Calcular Packs</button>
        </div>
    </div>
</section>
              

 <!-- Resultados Detallados -->
<section class="section" id="resultsTable">
    <h2>Resultados Detallados</h2>
    <div class="results-table-container" style="overflow-x:auto;">
        <table>
            <thead>
                <tr>
                    <th>Pack</th>
                    <th>Costo Total</th>
                    <th>Unidades Vendidas</th>
                    <th>Precio Promedio</th>
                    <th>Ingresos</th>
                    <th>Utilidad</th>
                </tr>
            </thead>
            <tbody id="resultsBody"></tbody>
        </table>
    </div>
    
    <!-- Gr√°fico abajo -->
    <div style="margin-top:2rem;">
        <h2>üìà Rentabilidad por Pack</h2>
        <canvas id="profitChart"></canvas>
    </div>
</section>

<script>
let profitChart = null;

// Formateo de n√∫meros como moneda
function formatCurrency(value) {
    return value.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 2 });
}

// Descuentos por cliente
const descuentos = {
    'A': 0.16,
    'B': 0.11,
    'C': 0.05
};


// Funci√≥n principal para calcular tabla y gr√°fico
function calculateResults() {
         // Obtener el tipo de cliente seleccionado
    const clienteSeleccionado = document.getElementById('clientSelect').value;
    const descuentoCliente = descuentos[clienteSeleccionado] || 0;

// Guardar tambi√©n la etiqueta del cliente (para mostrarla)
let clienteLabel = '';
if (clienteSeleccionado === 'A') clienteLabel = 'Cliente A (16%)';
if (clienteSeleccionado === 'B') clienteLabel = 'Cliente B (11%)';
if (clienteSeleccionado === 'C') clienteLabel = 'Cliente C (5%)';

   // üîπ Validar descuentos antes de calcular
    document.querySelectorAll('input[type="number"][id^="discount"]').forEach(input => {
        if (parseFloat(input.value) > 20) {
            input.value = 20;
        }
        if (parseFloat(input.value) < 0) {
            input.value = 0;
        }
    });
    const packs = [
        {
            name: "Pack A",
            components: [
                
                { priceId:'priceGonal450', qtyId:'qtyGonal450', discountId:'discountGonal450' },
                 { priceId: 'priceCrinone', qtyId: 'qtyCrinone', discountId: 'discountCrinone' },
                { priceId:'priceOvidA', qtyId:'qtyOvidA', discountId:null }
            ],
            unitsSoldId: 'unitsSoldPackA',
            costInputId: 'costPackA'
        },
            ];

    const resultsBody = document.getElementById('resultsBody');
    resultsBody.innerHTML = '';

    let totalMargins = 0;
    let minCost = Infinity;
    let maxProfit = -Infinity;
    let bestPack = '';
    let cheapestPack = '';

    packs.forEach(pack => {
        const unitsSold = parseFloat(document.getElementById(pack.unitsSoldId).value) || 1;

        let totalCostUnit = 0;
        let totalNetUnit = 0;

        // Sumar costo y ventas por componente
        pack.components.forEach(c => {
            const price = parseFloat(document.getElementById(c.priceId).value) || 0;
            const qty = parseFloat(document.getElementById(c.qtyId).value) || 0;
            const discount = c.discountId ? (parseFloat(document.getElementById(c.discountId).value) || 0)/100 : 0;
            const cost = price * qty;
            const net = cost * (1 - discount);

            totalCostUnit += cost;
            totalNetUnit += net;
        });

        const totalCost = totalCostUnit * unitsSold;
        const salesNet = totalNetUnit * unitsSold;
        const margin = salesNet - totalCost;
        const avgCostPerUnit = totalCostUnit;
        
       // üîπ Calcular precio √≥ptimo seg√∫n el cliente seleccionado
const optimalNetUnit = totalCostUnit * (1 - descuentoCliente);
const optimalNetTotal = optimalNetUnit * unitsSold;

// üîπ Desviaci√≥n entre el descuento aplicado y el √≥ptimo
const desviacionPct = ((totalNetUnit - optimalNetUnit) / optimalNetUnit) * 100;

        // Actualizar input de costo total
        document.getElementById(pack.costInputId).value = totalCostUnit.toFixed(2);

        totalMargins += margin;

        // Determinar KPI
        if(margin > maxProfit){ maxProfit = margin; bestPack = pack.name; }
        if(totalCost < minCost){ minCost = totalCost; cheapestPack = pack.name; }

        // Color y s√≠mbolo seg√∫n desviaci√≥n
let desviacionColor = desviacionPct > 0 ? '#2e8b57' : '#d5006d';
let desviacionIcon = desviacionPct > 0 ? 'üî∫' : 'üîª';

resultsBody.innerHTML += `
<tr>
    <td>${pack.name}</td>
    <td>${formatCurrency(totalCost)}</td>
    <td>${unitsSold}</td>
    <td>${formatCurrency(avgCostPerUnit)}</td>
    <td>${formatCurrency(salesNet)}</td>
    <td>
        ${formatCurrency(margin)}<br>
        <span style="color:${desviacionColor}; font-size:0.9rem;">
            ${desviacionIcon} ${desviacionPct.toFixed(2)}% vs √≥ptimo
        </span>
    </td>
</tr>`;

    
// üîπ Fila optimizaci√≥n ‚ö° din√°mica
const opt = {
    precioPaciente: totalNetUnit, // precio promedio neto actual
    descuento: 1 - (totalNetUnit / totalCostUnit), // sugerencia de descuento sin p√©rdida
    ganancia: (totalNetUnit - totalCostUnit) * unitsSold
};

resultsBody.innerHTML += `<tr class="optimized">
    <td>‚ö° √ìptimo ${pack.name}</td>
    <td colspan="2">Tipo de cliente: ${clienteLabel}</td>
    <td colspan="2">Precio √≥ptimo: ${formatCurrency(optimalNetUnit.toFixed(2))}</td>
    <td>Descuento √≥ptimo: ${(descuentoCliente*100).toFixed(0)}%</td>
</tr>`;
    });

    // KPIs
    document.getElementById('kpi-rentable').innerText = bestPack;
    document.getElementById('kpi-economico').innerText = cheapestPack;
    document.getElementById('kpi-ahorro').innerText = ((totalMargins / packs.length).toFixed(2)) + ' $';

    // Gr√°fico
    const ctx = document.getElementById('profitChart').getContext('2d');
    if(profitChart) profitChart.destroy();

    profitChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: packs.map(p => p.name),
            datasets: [
                { 
                    label: 'Ventas Netas', 
                    data: packs.map(p => {
                        let netUnit = 0;
                        p.components.forEach(c => {
                            const price = parseFloat(document.getElementById(c.priceId).value) || 0;
                            const qty = parseFloat(document.getElementById(c.qtyId).value) || 0;
                            const discount = c.discountId ? (parseFloat(document.getElementById(c.discountId).value) || 0)/100 : 0;
                            netUnit += price * qty * (1 - discount);
                        });
                        return netUnit * (parseFloat(document.getElementById(p.unitsSoldId).value) || 1);
                    }), 
                    backgroundColor: '#d5006d' 
                },
                { 
                    label: 'Costo Total', 
                    data: packs.map(p => {
                        let costUnit = 0;
                        p.components.forEach(c => {
                            const price = parseFloat(document.getElementById(c.priceId).value) || 0;
                            const qty = parseFloat(document.getElementById(c.qtyId).value) || 0;
                            costUnit += price * qty;
                        });
                        return costUnit * (parseFloat(document.getElementById(p.unitsSoldId).value) || 1);
                    }), 
                    backgroundColor: '#ffb3c6' 
                }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
}
// Ejecutar c√°lculo al cargar la p√°gina
calculateResults();

</script>

</body>
</html>
